<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ржмрж╛ржВрж▓рж╛ ржмржЗ ржерзЗржХрзЗ ржкрзНрж░рж╢рзНржирзЛрждрзНрждрж░ рждрзИрж░рж┐ ржХрж░рзБржи</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        /* UI styling same as before */
        /* Keep your existing CSS here (not pasted due to length) */
    </style>
</head>
<body>
<div class="container">
    <h1>ржмрж╛ржВрж▓рж╛ ржмржЗ ржерзЗржХрзЗ ржкрзНрж░рж╢рзНржирзЛрждрзНрждрж░ рждрзИрж░рж┐ ржХрж░рзБржи</h1>

    <div class="card">
        <h2 class="section-title">ржмржЗрзЯрзЗрж░ ржкрзГрж╖рзНржарж╛ ржЖржкрж▓рзЛржб ржХрж░рзБржи</h2>
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ЁЯУД</div>
            <p>ржЫржмрж┐ ржЖржкрж▓рзЛржб ржХрж░рждрзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи ржмрж╛ ржлрж╛ржЗрж▓ржЯрж┐ ржПржЦрж╛ржирзЗ ржбрзНрж░ржк ржХрж░рзБржи</p>
            <p><small>рж╕ржорж░рзНржерж┐ржд ржлрж░ржорзНржпрж╛ржЯ: JPEG, PNG (рж╕рж░рзНржмрзЛржЪрзНржЪ 5MB)</small></p>
            <img id="imagePreview" alt="ржЖржкрж▓рзЛржб ржХрж░рж╛ ржЫржмрж┐рж░ ржкрзНрж░рж┐ржнрж┐ржЙ">
        </div>
        <input type="file" id="fileInput" accept="image/jpeg, image/png">
        <div class="loader" id="loader"></div>
        <p class="status" id="statusText"></p>
        <button id="extractBtn" class="btn" disabled>ржЯрзЗржХрзНрж╕ржЯ ржмрзЗрж░ ржХрж░рзБржи</button>
    </div>

    <div class="card">
        <h2 class="section-title">ржПржХрзНрж╕ржЯрзНрж░рж╛ржХрзНржЯ ржХрж░рж╛ ржЯрзЗржХрзНрж╕ржЯ</h2>
        <textarea id="extractedText" class="text-area" readonly></textarea>
        <button id="generateBtn" class="btn btn-secondary" disabled>ржкрзНрж░рж╢рзНржи рждрзИрж░рж┐ ржХрж░рзБржи</button>
    </div>

    <div class="card">
        <h2 class="section-title">ржкрзНрж░рж╢рзНржи ржУ ржЙрждрзНрждрж░</h2>
        <div id="questionsContainer"></div>
    </div>
</div>

<script>
const API_KEY = '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'; // ЁЯФС Replace with your OpenAI API Key

const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const imagePreview = document.getElementById('imagePreview');
const extractBtn = document.getElementById('extractBtn');
const extractedText = document.getElementById('extractedText');
const generateBtn = document.getElementById('generateBtn');
const questionsContainer = document.getElementById('questionsContainer');
const loader = document.getElementById('loader');
const statusText = document.getElementById('statusText');

let extractedBengaliText = '';

uploadArea.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', () => {
    if (fileInput.files.length) handleFile(fileInput.files[0]);
});

function handleFile(file) {
    const reader = new FileReader();
    reader.onload = e => {
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
        extractBtn.disabled = false;
    };
    reader.readAsDataURL(file);
}

extractBtn.addEventListener('click', () => {
    if (!fileInput.files.length) return;
    loader.style.display = 'block';
    statusText.textContent = 'ржЫржмрж┐рж░ ржЯрзЗржХрзНрж╕ржЯ ржкржбрж╝рж╛ рж╣ржЪрзНржЫрзЗ...';

    Tesseract.recognize(
        fileInput.files[0],
        'ben',
        {
            logger: m => console.log(m)
        }
    ).then(({ data: { text } }) => {
        extractedBengaliText = text.trim();
        extractedText.value = extractedBengaliText;
        loader.style.display = 'none';
        generateBtn.disabled = false;
        statusText.textContent = 'ржЯрзЗржХрзНрж╕ржЯ ржПржХрзНрж╕ржЯрзНрж░рж╛ржХрзНржЯ рж╕ржорзНржкржирзНржи тЬЕ';
    });
});

generateBtn.addEventListener('click', async () => {
    if (!extractedBengaliText.trim()) return;

    statusText.textContent = 'ржкрзНрж░рж╢рзНржи рждрзИрж░рж┐ рж╣ржЪрзНржЫрзЗ OpenAI ржжрзНржмрж╛рж░рж╛...';
    loader.style.display = 'block';

    const prompt = `
рждрзБржорж┐ ржПржХржЬржи ржжржХрзНрж╖ ржмрж╛ржВрж▓рж╛ рж╢рж┐ржХрзНрж╖ржХред ржирж┐ржЪрзЗрж░ ржмрж╛ржВрж▓рж╛ рж▓рзЗржЦрж╛рж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ рззрзлржЯрж┐ ржкрзНрж░рж╢рзНржи ржУ рж╕ржВржХрзНрж╖рж┐ржкрзНржд ржЙрждрзНрждрж░ JSON ржлрж░ржорзНржпрж╛ржЯрзЗ ржжрж╛ржУред ржмрзНржпрж╛ржЦрзНржпрж╛ рж▓рж┐ржЦржмрзЗ ржирж╛ред ржХрзЗржмрж▓ ржирж┐ржЪрзЗрж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░рзЗ рж▓рж┐ржЦржмрзЗ:

[
  {"q": "ржкрзНрж░рж╢рзНржи рзз", "a": "ржЙрждрзНрждрж░ рзз"},
  {"q": "ржкрзНрж░рж╢рзНржи рзи", "a": "ржЙрждрзНрждрж░ рзи"},
  ...
]

рж▓рзЗржЦрж╛:
"""
${extractedBengaliText.slice(0, 3000)}
"""
`;

    try {
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: 'gpt-3.5-turbo',
                messages: [
                    { role: 'user', content: prompt }
                ]
            })
        });

        const data = await res.json();
        const rawText = data.choices[0].message.content;
        const start = rawText.indexOf('[');
        const end = rawText.lastIndexOf(']') + 1;
        const parsed = JSON.parse(rawText.slice(start, end));

        displayQuestions(parsed);
        statusText.textContent = 'тЬЕ ржкрзНрж░рж╢рзНржи рждрзИрж░рж┐ рж╕ржорзНржкржирзНржи!';
    } catch (err) {
        statusText.textContent = 'тЭМ ржкрзНрж░рж╢рзНржи рждрзИрж░рж┐ ржмрзНржпрж░рзНрже: ' + err.message;
    } finally {
        loader.style.display = 'none';
    }
});

function displayQuestions(list) {
    questionsContainer.innerHTML = '';
    list.forEach((qa, i) => {
        const div = document.createElement('div');
        div.className = 'question-item';
        div.innerHTML = `<div class="question"><strong>${i + 1}. ${qa.q}</strong></div><div class="answer"><strong>ржЙрждрзНрждрж░:</strong> ${qa.a}</div>`;
        questionsContainer.appendChild(div);
    });
}
</script>
</body>
</html>
